{% extends 'base_content.html' %}
{% block content %}
<div class="w-100 d-flex flex-column">
  <div class="w-100 mb-4 d-flex justify-content-between align-items-center">
    <h1>Bookings</h1>

    <a type="button" class="btn btn-secondary d-inline-block px-3 rounded-pill" href="/new_booking">
      <i class="bi bi-plus-circle me-2"></i>
      New Booking
    </a>
  </div>
  <div class="filter-labels">
    <form method="get" class="d-flex gap-3 mb-4">
      <!-- Status Dropdown -->
      <select name="status" class="form-select w-auto">
          <option value="" {% if status_filter == '' %}selected{% endif %}>All</option>
          <option value="Booked" {% if status_filter == 'Booked' %}selected{% endif %}>Booked</option>
          <option value="Completed" {% if status_filter == 'Completed' %}selected{% endif %}>Completed</option>
      </select>
      <!-- Tutor Name Dropdown (visible only if the user is not a tutor) -->
      {% if not user.is_tutor %}
      <select name="tutor" class="form-select w-auto">
          <option value="" {% if tutor_filter == '' %}selected{% endif %}>All Tutors</option>
          {% for tutor in tutors %}
          <option value="{{ tutor.user.username }}" {% if tutor_filter == tutor.user.username %}selected{% endif %}>
              {{ tutor.user }}
          </option>
          {% endfor %}
      </select>
      {% endif %}
      <!-- Tutee Name Dropdown (visible only if the user is admin or tutor) -->
      {% if user.is_staff or user.is_tutor %}
      <select name="tutee" class="form-select w-auto">
          <option value="" {% if tutee_filter == '' %}selected{% endif %}>All Tutees</option>
          {% for tutee in tutees %}
          <option value="{{ tutee.user.username }}" {% if tutee_filter == tutee.user.username %}selected{% endif %}>
              {{ tutee.user }}
          </option>
          {% endfor %}
      </select>
      {% endif %}
      <!-- Submit Button -->
      <button type="submit" class="btn btn-primary">Filter</button>
    </form>
  </div>
  <hr class="filter-separator">
  <div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Date & Time</th>
          <th>Duration</th>
          <th>Language</th>
          {% if user.is_staff %}
            <th>Tutor</th>
            <th>Tutee</th>
          {% elif user.is_tutor%}
            <th>Tutee</th>
          {% else %}
            <th>Tutor</th>
          {% endif %}
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in bookings %}
        <tr>
          {% load tz %}
          <td>{{ booking.date_time|localtime|date:"m/d/Y g:i a" }}</td>
          <td>{{ booking.duration }}</td>
          <td>{{ booking.language }}</td>
          {% if user.is_staff %}
            <td>{{ booking.tutor.user.first_name }}</td>
            <td>{{ booking.tutee.user.first_name }}</td>
          {% elif user.is_tutor%}
            <td>{{ booking.tutee.user.first_name }}</td>
          {% else %}
            <td>{{ booking.tutor.user.first_name }}</td>
          {% endif %}
          <td>{% if booking.is_completed %}<div class="bg-success text-white d-inline-block px-3 rounded-pill">Completed</div>{% else %}<div class="bg-warning d-inline-block px-3 rounded-pill">Booked</div>{% endif %}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7">No bookings available.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
